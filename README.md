# smithy-protovalidate

A tool that post-processes Protocol Buffer files generated by [Disney's smithy-translate](https://github.com/disneystreaming/smithy-translate) to add ProtoValidate field options derived from Smithy traits.

## Overview

smithy-protovalidate is a standalone Python-based tool that enhances Protocol Buffer files by injecting validation rules based on Smithy traits. It bridges the gap between Smithy's validation traits and Protocol Buffer's validation capabilities using ProtoValidate.

The script should be ran after the proto files have been generated and before the source code is generated by protoc.

**This project is a temporary workaround.**

## Features

- Converts Smithy traits to Protocol Buffer ProtoValidate validation rules
- Supports the following Smithy traits:
  - `@length(min/max)` → strings & lists
  - `@range(min/max)` → numeric members and aliases
  - `@uniqueItems` → lists
- Automatically injects validation rules into generated .proto files

## Usage

```bash
python src/main/python/inject_protovalidate.py <smithy-root-dir> <proto-root-dir>
```

### Arguments

- `smithy-root-dir`: Root directory containing Smithy model files
- `proto-root-dir`: Root directory containing generated Protocol Buffer files

## Development

### Setup

1. Create a virtual environment:

```bash
python -m venv venv
source venv/bin/activate  # On Windows: venv\Scripts\activate
```

2. Install dependencies:

```bash
pip install -r requirements.txt
```

### Testing

The project uses pytest for testing. To run the tests:

```bash
# Run all tests
pytest

# Run tests with coverage report
pytest --cov=src/main
```

## Example

Given a Smithy model with traits:

```smithy
@length(min: 1, max: 100)
string Name

@range(min: 0, max: 120)
integer Age

@uniqueItems
list Tags
```

The tool will automatically inject corresponding validation rules into the generated Protocol Buffer files.
